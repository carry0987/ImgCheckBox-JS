!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ImgCheckBox=t()}(this,(function(){"use strict";const e="imgChked",t={"top-left":{top:"0.5%",left:"0.5%"},top:{top:"0.5%",left:0,right:0,margin:"auto"},"top-right":{top:"0.5%",right:"0.5%"},left:{left:"0.5%",bottom:0,top:0,margin:"auto"},right:{right:"0.5%",bottom:0,top:0,margin:"auto"},"bottom-left":{bottom:"0.5%",left:"0.5%"},bottom:{bottom:"0.5%",left:0,right:0,margin:"auto"},"bottom-right":{bottom:"0.5%",right:"0.5%"},center:{top:"0.5%",bottom:"0.5%",left:"0.5%",right:"0.5%",margin:"auto"}},i={checkMarkImage:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCAtMzQ2LjM4NCkiPjxwYXRoIGZpbGw9IiMxZWM4MWUiIGZpbGwtb3BhY2l0eT0iLjgiIGQ9Ik0zMiAzNDYuNGEzMiAzMiAwIDAgMC0zMiAzMiAzMiAzMiAwIDAgMCAzMiAzMiAzMiAzMiAwIDAgMCAzMi0zMiAzMiAzMiAwIDAgMC0zMi0zMnptMjEuMyAxMC4zbC0yNC41IDQxTDkuNSAzNzVsMTcuNyA5LjYgMjYtMjh6Ii8+PHBhdGggZmlsbD0iI2ZmZiIgZD0iTTkuNSAzNzUuMmwxOS4zIDIyLjQgMjQuNS00MS0yNiAyOC4yeiIvPjwvZz48L3N2Zz4=",enableShiftClick:!0,graySelected:!0,scaleSelected:!0,fixedImageSize:!1,checkMark:"imgChked",checkMarkSize:"30px",checkMarkPosition:"top-left",scaleCheckMark:!0,fadeCheckMark:!1,addToForm:!1,inputValueAttribute:null,preselect:[],radio:!1,canDeselect:!1,styles:{},debugMessages:!1},s={"span.imgCheckbox":{"user-select":"none","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none",position:"relative",padding:"0",margin:"2px",display:"inline-block",border:"1px solid transparent","transition-duration":"300ms"},"span.imgCheckbox img":{display:"block",margin:"0",padding:"0","transition-duration":"300ms"},"span.imgCheckbox::before":{display:"block","background-size":"100% 100%",content:"''",color:"white","font-weight":"bold","border-radius":"50%",position:"absolute",margin:"0.5%","z-index":"1","text-align":"center","transition-duration":"300ms"}};function n(e,t,i){if("string"!=typeof e)return e;let s=document;return null===t&&i?s=i:t&&t instanceof Node&&"querySelector"in t?s=t:i&&i instanceof Node&&"querySelector"in i&&(s=i),"all"===t?s.querySelectorAll(e):s.querySelector(e)}let o="utils-style";const r={from:".utils",to:".utils-"};function l(e){return"object"==typeof e&&null!==e&&!c(e)}function c(e){return Array.isArray(e)}function a(e){return"number"!=typeof e&&("string"==typeof e&&0===e.length||(!(!c(e)||0!==e.length)||(!(!l(e)||0!==Object.keys(e).length)||!e)))}function h(e,...t){if(!t.length)return e;const i=t.shift();if(i)for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t)){const s=i[t],n=t;l(s)||c(s)?(e[n]&&"object"==typeof e[n]||(e[n]=c(s)?[]:{}),h(e[n],s)):e[n]=s}return h(e,...t)}function d(e){o=e}function m(e,t){r.from=e,r.to=t}function g(e,t=null){t=a(t)?"":t;let i=function(e,t={},i=""){let s=document.createElement(e);for(let e in t)Object.prototype.hasOwnProperty.call(t,e)&&("textContent"===e||"innerText"===e?s.textContent=t[e]:s.setAttribute(e,t[e]));return i&&(s.textContent=i),s}("style");i.id=o+t,i.textContent="",document.head.append(i);let s=i.sheet;for(let i in e)e.hasOwnProperty(i)&&u(s,i,f(e[i]),t)}function f(e){let t="";for(let[i,s]of Object.entries(e))i=i.replace(/([A-Z])/g,(e=>`-${e[0].toLowerCase()}`)),t+=`${i}:${s};`;return t}function u(e,t,i,s=null){s=a(s)?"":s;let n=t.replace(r.from,r.to+s);e.insertRule(n+"{"+i+"}",0)}function p(e=null){const t=a(e)?"":e;let i=n("#"+o+t);i&&i.parentNode&&i.parentNode.removeChild(i)}class b{static deepMerge=h;static setStylesheetId=d;static setReplaceRule=m;static injectStylesheet=g;static removeStylesheet=p;static getElem=n;static throwError=e=>{!function(e){throw new Error(e)}("[ImgCheckBox]: "+e)};static changeSelection(e,t,i,s,n,o,r){const{CHECK_MARK:l,CHK_DESELECT:c,CHK_TOGGLE:a,CHK_SELECT:h}=r;s&&t!==c?(o.forEach((t=>t!==e&&t.classList.remove(l))),n?e.classList.toggle(l):e.classList.add(l)):t===c&&e.classList.remove(l)||t===a&&e.classList.toggle(l)||t===h&&e.classList.add(l);const d=e.classList.contains(l);return i&&b.updateFormValues(s?o:e,l),d}static updateFormValues(e,t){(e instanceof Array?e:[e]).forEach((e=>{if(!("dataset"in e))return;const i=b.getElem("."+e.dataset.hiddenElementId,"all");i&&i.forEach((i=>{if(i instanceof HTMLElement&&"input"===i.tagName.toLowerCase()){const s=i;s.checked=e.classList.contains(t),s.checked?s.setAttribute("checked","checked"):s.removeAttribute("checked")}}))}))}static buildStyles(e,t,i,s){let n={};const o=(e,i,s=!1)=>{let o=e.startsWith("::")?"":" ";e||(o="."+t),n[`span.imgCheckbox${s?"."+t:""}${o}${e}`]=i};if("object"==typeof i&&"object"==typeof s)o(e,i),o(e,s,!0);else for(let[e,t]of Object.entries(i))o(e,t,!!e);return n}}b.setStylesheetId("imgCheckbox-style"),b.setReplaceRule(".imgCheckbox",".imgCheckbox");class k{callbacks={};init(e){e&&!this.callbacks[e]&&(this.callbacks[e]=[])}checkListener(e){if("function"!=typeof e)throw new TypeError("The listener must be a function")}hasEvent(e){return void 0!==this.callbacks[e]}listeners(){return this.callbacks}addListener(e,t){return this.on(e,t)}clearListener(e){return e?this.callbacks[e]=[]:this.callbacks={},this}on(e,t){return this.checkListener(t),this.init(e),this.callbacks[e].push(t),this}off(e,t){t&&this.checkListener(t);const i=e;return this.init(),this.callbacks[i]&&0!==this.callbacks[i].length?(this.callbacks[i]=t?this.callbacks[i].filter((e=>e!==t)):[],this):this}emit(e,...t){const i=e;if(this.init(i),this.callbacks[i].length<=0)return!1;const s=this.callbacks[i].map((e=>{try{const i=e(...t);return i instanceof Promise?i:Promise.resolve(i)}catch(e){return console.error(`Error in event listener for event: ${i}`,e),Promise.resolve()}}));return!s.some((e=>e instanceof Promise))||Promise.all(s).then((()=>!0)).catch((e=>(console.error(`Error handling promises for event: ${i}`,e),!1)))}once(e,t){this.checkListener(t);const i=(...s)=>{const n=t(...s);return this.off(e,i),n instanceof Promise?n:Promise.resolve(n)};return this.on(e,i)}}class y extends k{static instances=[];static version="3.0.4";element=[];options=i;targetIndex=0;imgChkMethods=new Map;constructor(e,t){return super(),this.initialize(e,t),y.instances.push(this),1===y.instances.length&&((e,t=!1)=>{!0===t?console.log("Data Type : "+typeof e,"\nValue : "+e):"boolean"!=typeof t?console.log(t):console.log(e)})(`ImgCheckBox is loaded, version: ${y.version}`),this}initialize(e,t){let s=b.getElem(e,"all");s||b.throwError("Element not found"),this.element=Array.isArray(s)?s:s instanceof NodeList?Array.from(s):[s],0===this.element.length&&b.throwError("Element not found"),this.options=b.deepMerge({},i,t||{}),this.createImgCheckbox(y.instances.length)}createImgCheckbox(i){const n=this.element,o=this.options;let r=null,l={},c=[],a=b.buildStyles("img",e,{transform:"scale(1)",filter:"none","-webkit-filter":"grayscale(0)"},{filter:"grayscale(1)","-webkit-filter":"grayscale(1)"}),h=b.buildStyles("img",e,{transform:"scale(1)"},{transform:"scale(0.9)"}),d=b.buildStyles("::before",e,{transform:"scale(0)"},{transform:"scale(1)"}),m=b.buildStyles("::before",e,{opacity:"0"},{opacity:"1"});o.checkMarkImage&&b.deepMerge(l,{"span.imgCheckbox::before":{"background-image":"url('"+o.checkMarkImage+"')"}});let g=o.checkMarkSize.split(" ");if(b.deepMerge(l,{"span.imgCheckbox::before":{width:g[0],height:g[g.length-1]}}),b.deepMerge(l,{"span.imgCheckbox::before":t[o.checkMarkPosition]}),o.fixedImageSize&&"string"==typeof o.fixedImageSize){let e=o.fixedImageSize.split(" ");b.deepMerge(l,{"span.imgCheckbox img":{width:e[0],height:e[e.length-1]}})}[{doExtension:o.graySelected,style:a},{doExtension:o.scaleSelected,style:h},{doExtension:o.scaleCheckMark,style:d},{doExtension:o.fadeCheckMark,style:m}].forEach((e=>{e.doExtension&&b.deepMerge(l,e.style)})),b.deepMerge(s,b.buildStyles("",e,{"":{"border-color":"#ccc"},img:{},"::before":{}})),l=b.deepMerge({},s,l,o.styles),b.injectStylesheet(l,i.toString());for(let e=0;e<n.length;e++){let t=n[e];if(t.parentNode?.classList.contains("imgCheckbox"+i))continue;if("img"!==t.tagName.toLowerCase())continue;t.ondragstart=()=>!1;let s=document.createElement("span");s.className="imgCheckbox"+i,t.parentNode?.insertBefore(s,t),s.appendChild(t),c.push(s);const r={deselect:()=>{b.changeSelection(s,2,o.addToForm,o.radio,o.canDeselect,c,y.constants),this.emit("deselect",s),this.emit("change",s,!1)},select:()=>{b.changeSelection(s,1,o.addToForm,o.radio,o.canDeselect,c,y.constants),this.emit("select",s),this.emit("change",s,!0)}};if(this.imgChkMethods.set(s,r),s.firstChild&&s.firstChild instanceof HTMLElement&&this.imgChkMethods.set(s.firstChild,r),o.addToForm instanceof Element||!0===o.addToForm){let s=null;s=!0===o.addToForm?t.closest("form"):o.addToForm;let n=o.inputValueAttribute&&t.getAttribute(o.inputValueAttribute)||"";if(s){let o="hEI"+i+"-"+e;const r=t.parentElement;r&&"dataset"in r&&(r.dataset.hiddenElementId=o);let l=t.getAttribute("name")||t.src.match(/\/([^\/]+)\.\w+$/)?.[1]||"",c=document.createElement("input");c.type="checkbox",c.name=l,c.className=o,c.style.display="none",c.value=n,s.appendChild(c)}else o.debugMessages&&console.warn("[ImgCheckBox]: No form found (looks for form by default)")}}return Array.isArray(this.options.preselect)?this.options.preselect.forEach((e=>{e>=0&&e<c.length&&this.imgChkMethods.get(c[e])?.select()})):!0===this.options.preselect&&c.forEach((e=>{this.imgChkMethods.get(e)?.select()})),c.forEach((t=>{t.addEventListener("click",(i=>{if(o.enableShiftClick&&!o.radio&&i.shiftKey&&r){let i=c.indexOf(r),s=c.indexOf(t);i>s&&([i,s]=[s,i]);for(let t=i;t<=s;t++){const i=c[t];i.classList.contains(e)||(this.imgChkMethods.get(i)?.select(),this.emit("click",i,!0))}}else{const e=b.changeSelection(t,0,o.addToForm,o.radio,o.canDeselect,c,y.constants);this.emit("click",t,e),e?this.emit("select",t):this.emit("deselect",t),this.emit("change",t,e)}r=t}))})),this}target(e){if(e>=0&&e<this.element.length)return this.targetIndex=e,this;b.throwError("The given index is out of range.")}state(){const t=b.getElem(this.element[this.targetIndex]).parentNode;return t&&t.classList.contains(e)}select(e){e<0||e>=this.element.length?b.throwError("The given index is out of range."):this.imgChkMethods.get(this.element[e])?.select()}deselect(e){e<0||e>=this.element.length?b.throwError("The given index is out of range."):this.imgChkMethods.get(this.element[e])?.deselect()}selectAll(){this.element.forEach((e=>{this.imgChkMethods.get(e)?.select()})),this.emit("selectAll",this.element)}deselectAll(){this.element.forEach((e=>{this.imgChkMethods.get(e)?.deselect()})),this.emit("deselectAll")}destroy(){let e=y.instances.indexOf(this);e<0?b.throwError("Instance not found"):(b.removeStylesheet(e.toString()),this.element.forEach((t=>{let i=t.parentNode;i&&i.classList.contains("imgCheckbox"+e)&&(i.parentNode?.insertBefore(t,i),i.parentNode?.removeChild(i))})),this.clearListener(),y.instances.splice(e,1))}getChecked(){return this.element.filter((t=>t.parentElement?.classList.contains(e)))}getUnchecked(){return this.element.filter((t=>!t.parentElement?.classList.contains(e)))}get length(){return this.element.length}static get constants(){return{CHECK_MARK:e,CHK_DESELECT:2,CHK_TOGGLE:0,CHK_SELECT:1}}}return y}));
