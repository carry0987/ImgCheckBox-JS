!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ImgCheckBox=t()}(this,(function(){"use strict";function e(e){throw new Error(e)}var t=Object.freeze({__proto__:null,reportError:function(...e){console.error(...e)},throwError:e});function n(e,t,n){if("string"!=typeof e)return e;let i=document;return null===t&&n?i=n:t&&t instanceof Node&&"querySelector"in t?i=t:n&&n instanceof Node&&"querySelector"in n&&(i=n),"all"===t?i.querySelectorAll(e):i.querySelector(e)}function i(e,t={},n=""){let i=document.createElement(e);for(let e in t)Object.prototype.hasOwnProperty.call(t,e)&&("textContent"===e||"innerText"===e?i.textContent=t[e]:i.setAttribute(e,t[e]));return n&&(i.textContent=n),i}var o=Object.freeze({__proto__:null,addClass:function(e,t){return e.classList.add(t),e},createElem:i,getElem:n,hasClass:function(e,t){return e.classList.contains(t)},insertAfter:function(t,n){if("string"==typeof n){let t=i("div");t.innerHTML=n,(n=t.firstChild)||e("The new node (string) provided did not produce a valid DOM element.")}t.parentNode.insertBefore(n,t.nextSibling)},insertBefore:function(t,n){if("string"==typeof n){let t=i("div");t.innerHTML=n,(n=t.firstChild)||e("The new node (string) provided did not produce a valid DOM element.")}t.parentNode.insertBefore(n,t)},removeClass:function(e,t){return e.classList.remove(t),e},toggleClass:function(e,t){return e.classList.toggle(t),e}});let s="utils-style";const r={from:".utils",to:".utils-"};function l(e,...t){if(!t.length)return e;const n=t.shift();if(n)for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const o=n[t],s=t;"object"!=typeof(i=o)||null===i||Array.isArray(i)?e[s]=o:(e[s]&&"object"==typeof e[s]||(e[s]={}),l(e[s],o))}var i;return l(e,...t)}function c(e){s=e}function a(e,t){r.from=e,r.to=t}function h(e,t=null){t=f(t)?"":t;let n=i("style");n.id=s+t,n.textContent="",document.head.append(n);let o=n.sheet;for(let n in e)e.hasOwnProperty(n)&&g(o,n,d(e[n]),t)}function d(e){let t="";for(let[n,i]of Object.entries(e))n=n.replace(/([A-Z])/g,(e=>`-${e[0].toLowerCase()}`)),t+=`${n}:${i};`;return t}function g(e,t,n,i=null){i=f(i)?"":i;let o=t.replace(r.from,r.to+i);e.insertRule(o+"{"+n+"}",0)}function m(e=null){e=f(e)?"":e;let t=n("#"+s+e);t&&t.parentNode.removeChild(t)}function f(e){return"number"!=typeof e&&(!e||"string"==typeof e&&0===e.length)}class u{static throwError=t.throwError;static deepMerge=l;static setStylesheetId=c;static setReplaceRule=a;static injectStylesheet=h;static removeStylesheet=m;static getElem=o.getElem;static changeSelection(e,t,n,i,o,s,r){const{CHECK_MARK:l,CHK_DESELECT:c,CHK_TOGGLE:a,CHK_SELECT:h}=r,d=e.classList.contains(l);i&&t!==c?(s.forEach((t=>t!==e&&t.classList.remove(l))),o?e.classList.toggle(l):e.classList.add(l)):t===c&&e.classList.remove(l)||t===a&&e.classList.toggle(l)||t===h&&e.classList.add(l);const g=e.classList.contains(l);if(d!==g){const t=new CustomEvent("change",{detail:{isSelected:g}});e.dispatchEvent(t)}return n&&u.updateFormValues(i?s:e,l),g}static updateFormValues(e,t){(e instanceof Array?e:[e]).forEach((e=>{if(!("dataset"in e))return;const n=u.getElem("."+e.dataset.hiddenElementId,"all");n&&n.forEach((n=>{if(n instanceof HTMLElement&&"input"===n.tagName.toLowerCase()){const i=n;i.checked=e.classList.contains(t),i.checked?i.setAttribute("checked","checked"):i.removeAttribute("checked")}}))}))}static buildStyles(e,t,n,i){let o={};const s=(e,n,i=!1)=>{let s=e.startsWith("::")?"":" ";e||(s="."+t),o[`span.imgCheckbox${i?"."+t:""}${s}${e}`]=n};if("object"==typeof n&&"object"==typeof i)s(e,n),s(e,i,!0);else for(let[e,t]of Object.entries(n))s(e,t,!!e);return o}}u.setStylesheetId("imgCheckbox-style"),u.setReplaceRule(".imgCheckbox",".imgCheckbox");const E="imgChked",p={"top-left":{top:"0.5%",left:"0.5%"},top:{top:"0.5%",left:0,right:0,margin:"auto"},"top-right":{top:"0.5%",right:"0.5%"},left:{left:"0.5%",bottom:0,top:0,margin:"auto"},right:{right:"0.5%",bottom:0,top:0,margin:"auto"},"bottom-left":{bottom:"0.5%",left:"0.5%"},bottom:{bottom:"0.5%",left:0,right:0,margin:"auto"},"bottom-right":{bottom:"0.5%",right:"0.5%"},center:{top:"0.5%",bottom:"0.5%",left:"0.5%",right:"0.5%",margin:"auto"}},C={checkMarkImage:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCAtMzQ2LjM4NCkiPjxwYXRoIGZpbGw9IiMxZWM4MWUiIGZpbGwtb3BhY2l0eT0iLjgiIGQ9Ik0zMiAzNDYuNGEzMiAzMiAwIDAgMC0zMiAzMiAzMiAzMiAwIDAgMCAzMiAzMiAzMiAzMiAwIDAgMCAzMi0zMiAzMiAzMiAwIDAgMC0zMi0zMnptMjEuMyAxMC4zbC0yNC41IDQxTDkuNSAzNzVsMTcuNyA5LjYgMjYtMjh6Ii8+PHBhdGggZmlsbD0iI2ZmZiIgZD0iTTkuNSAzNzUuMmwxOS4zIDIyLjQgMjQuNS00MS0yNiAyOC4yeiIvPjwvZz48L3N2Zz4=",enableShiftClick:!0,graySelected:!0,scaleSelected:!0,fixedImageSize:!1,checkMark:"imgChked",checkMarkSize:"30px",checkMarkPosition:"top-left",scaleCheckMark:!0,fadeCheckMark:!1,addToForm:!1,inputValueAttribute:null,preselect:[],radio:!1,canDeselect:!1,styles:{},debugMessages:!1},b={"span.imgCheckbox":{"user-select":"none","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none",position:"relative",padding:"0",margin:"2px",display:"inline-block",border:"1px solid transparent","transition-duration":"300ms"},"span.imgCheckbox img":{display:"block",margin:"0",padding:"0","transition-duration":"300ms"},"span.imgCheckbox::before":{display:"block","background-size":"100% 100%",content:"''",color:"white","font-weight":"bold","border-radius":"50%",position:"absolute",margin:"0.5%","z-index":"1","text-align":"center","transition-duration":"300ms"}};class k{static instances=[];static version="2.1.0";element;options;targetIndex=0;imgChkMethods=new Map;static EVENT_CLICK="click";static EVENT_CHANGE="change";static EVENT_SELECT="select";static EVENT_DESELECT="deselect";_onClick=null;_onChange=null;_onSelect=null;_onDeselect=null;constructor(e,t={}){this.init(e,t),k.instances.push(this),1===k.instances.length&&((e,t=!1)=>{!0===t?console.log("Data Type : "+typeof e,"\nValue : "+e):"boolean"!=typeof t?console.log(t):console.log(e)})(`ImgCheckBox is loaded, version: ${k.version}`)}init(e,t){let n=u.getElem(e,"all");n||u.throwError("Element not found"),this.element=Array.isArray(n)?n:n instanceof NodeList?Array.from(n):[n],0===this.element.length&&u.throwError("Element not found"),this.options=u.deepMerge({},C,t),this._onClick=t.onClick||null,this._onChange=t.onChange||null,this._onSelect=t.onSelect||null,this._onDeselect=t.onDeselect||null,this.options?.onLoad?.(),this.createImgCheckbox(k.instances.length)}createImgCheckbox(e){const t=this.element,n=this.options;let i=null,o={},s=[],r=u.buildStyles("img",E,{transform:"scale(1)",filter:"none","-webkit-filter":"grayscale(0)"},{filter:"grayscale(1)","-webkit-filter":"grayscale(1)"}),l=u.buildStyles("img",E,{transform:"scale(1)"},{transform:"scale(0.9)"}),c=u.buildStyles("::before",E,{transform:"scale(0)"},{transform:"scale(1)"}),a=u.buildStyles("::before",E,{opacity:"0"},{opacity:"1"});n.checkMarkImage&&u.deepMerge(o,{"span.imgCheckbox::before":{"background-image":"url('"+n.checkMarkImage+"')"}});let h=n.checkMarkSize.split(" ");if(u.deepMerge(o,{"span.imgCheckbox::before":{width:h[0],height:h[h.length-1]}}),u.deepMerge(o,{"span.imgCheckbox::before":p[n.checkMarkPosition]}),n.fixedImageSize&&"string"==typeof n.fixedImageSize){let e=n.fixedImageSize.split(" ");u.deepMerge(o,{"span.imgCheckbox img":{width:e[0],height:e[e.length-1]}})}[{doExtension:n.graySelected,style:r},{doExtension:n.scaleSelected,style:l},{doExtension:n.scaleCheckMark,style:c},{doExtension:n.fadeCheckMark,style:a}].forEach((function(e){e.doExtension&&u.deepMerge(o,e.style)})),u.deepMerge(b,u.buildStyles("",E,{"":{"border-color":"#ccc"},img:{},"::before":{}})),o=u.deepMerge({},b,o,n.styles),u.injectStylesheet(o,e.toString());for(let i=0;i<t.length;i++){let o=t[i];if(o.parentNode?.classList.contains("imgCheckbox"+e))continue;if("img"!==o.tagName.toLowerCase())continue;o.ondragstart=()=>!1;let r=document.createElement("span");r.className="imgCheckbox"+e,o.parentNode?.insertBefore(r,o),r.appendChild(o),s.push(r);const l={deselect:()=>{u.changeSelection(r,2,n.addToForm,n.radio,n.canDeselect,s,k.constants),this.triggerEvent(k.EVENT_DESELECT,r)},select:()=>{u.changeSelection(r,1,n.addToForm,n.radio,n.canDeselect,s,k.constants),this.triggerEvent(k.EVENT_SELECT,r)}};if(this.imgChkMethods.set(r,l),r.firstChild&&r.firstChild instanceof HTMLElement&&this.imgChkMethods.set(r.firstChild,l),n.addToForm instanceof Element||!0===n.addToForm){let t=null;t=!0===n.addToForm?o.closest("form"):n.addToForm;let s=n.inputValueAttribute&&o.getAttribute(n.inputValueAttribute)||"";if(t){let n="hEI"+e+"-"+i;const r=o.parentElement;r&&"dataset"in r&&(r.dataset.hiddenElementId=n);let l=o.getAttribute("name")||o.src.match(/\/([^\/]+)\.\w+$/)?.[1]||"",c=document.createElement("input");c.type="checkbox",c.name=l,c.className=n,c.style.display="none",c.value=s,t.appendChild(c)}else n.debugMessages&&console.warn("ImgCheckBox: no form found (looks for form by default)")}}return Array.isArray(this.options.preselect)?this.options.preselect.forEach((e=>{if(e>=0&&e<s.length){const t=this.imgChkMethods.get(s[e])?.select;t?.()}})):!0===this.options.preselect&&s.forEach((e=>{const t=this.imgChkMethods.get(e)?.select;t?.()})),s.forEach((e=>{e.addEventListener("click",(t=>{if(n.enableShiftClick&&!n.radio&&t.shiftKey&&i){let t=s.indexOf(i),n=s.indexOf(e);t>n&&([t,n]=[n,t]);for(let e=t;e<=n;e++){const t=s[e];if(!t.classList.contains(E)){const e=this.imgChkMethods.get(t)?.select;e?.(),this.triggerEvent(k.EVENT_CLICK,t,!0),this.triggerEvent(k.EVENT_CHANGE,t,!0)}}}else{const t=u.changeSelection(e,0,n.addToForm,n.radio,n.canDeselect,s,k.constants);this.triggerEvent(k.EVENT_CLICK,e,t),t?this.triggerEvent(k.EVENT_SELECT,e):this.triggerEvent(k.EVENT_DESELECT,e)}i=e})),e.addEventListener("change",(t=>{const n=t;this.triggerEvent(k.EVENT_CHANGE,e,n.detail.isSelected)}))})),this}triggerEvent(e,t,n){switch(e){case k.EVENT_CLICK:void 0!==n&&this._onClick?.(t,n);break;case k.EVENT_CHANGE:void 0!==n&&this._onChange?.(t,n);break;case k.EVENT_SELECT:this._onSelect?.(t);break;case k.EVENT_DESELECT:this._onDeselect?.(t);break;default:u.throwError(`Unsupported event type: ${e}`)}}target(e){if(e>=0&&e<this.element.length)return this.targetIndex=e,this;u.throwError("The given index is out of range.")}state(){const e=u.getElem(this.element[this.targetIndex]).parentNode;return e&&e.classList.contains(E)}select(e){e<0||e>=this.element.length?u.throwError("The given index is out of range."):this.element[e].imgChkSelect?.()}deselect(e){e<0||e>=this.element.length?u.throwError("The given index is out of range."):this.element[e].imgChkDeselect?.()}selectAll(){this.element.forEach((e=>e.imgChkSelect?.()))}deselectAll(){this.element.forEach((e=>e.imgChkDeselect?.()))}destroy(){let e=k.instances.indexOf(this);e<0?u.throwError("ImgCheckBox instance not found"):(u.removeStylesheet(e.toString()),this.element.forEach((t=>{let n=t.parentNode;n&&n.classList.contains("imgCheckbox"+e)&&(n.parentNode?.insertBefore(t,n),n.parentNode?.removeChild(n))})),k.instances.splice(e,1))}getChecked(){return this.element.filter((e=>e.parentElement?.classList.contains(E)))}getUnchecked(){return this.element.filter((e=>!e.parentElement?.classList.contains(E)))}set onClick(e){this._onClick=e}set onChange(e){this._onChange=e}set onSelect(e){this._onSelect=e}set onDeselect(e){this._onDeselect=e}get length(){return this.element.length}static get constants(){return{CHECK_MARK:E,CHK_DESELECT:2,CHK_TOGGLE:0,CHK_SELECT:1}}}return k}));
