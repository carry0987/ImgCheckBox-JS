!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).imgCheckBoxjs={})}(this,(function(e){"use strict";const t="imgChked",i={"top-left":{top:"0.5%",left:"0.5%"},top:{top:"0.5%",left:0,right:0,margin:"auto"},"top-right":{top:"0.5%",right:"0.5%"},left:{left:"0.5%",bottom:0,top:0,margin:"auto"},right:{right:"0.5%",bottom:0,top:0,margin:"auto"},"bottom-left":{bottom:"0.5%",left:"0.5%"},bottom:{bottom:"0.5%",left:0,right:0,margin:"auto"},"bottom-right":{bottom:"0.5%",right:"0.5%"},center:{top:"0.5%",bottom:"0.5%",left:"0.5%",right:"0.5%",margin:"auto"}},s={checkMarkImage:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCAtMzQ2LjM4NCkiPjxwYXRoIGZpbGw9IiMxZWM4MWUiIGZpbGwtb3BhY2l0eT0iLjgiIGQ9Ik0zMiAzNDYuNGEzMiAzMiAwIDAgMC0zMiAzMiAzMiAzMiAwIDAgMCAzMiAzMiAzMiAzMiAwIDAgMCAzMi0zMiAzMiAzMiAwIDAgMC0zMi0zMnptMjEuMyAxMC4zbC0yNC41IDQxTDkuNSAzNzVsMTcuNyA5LjYgMjYtMjh6Ii8+PHBhdGggZmlsbD0iI2ZmZiIgZD0iTTkuNSAzNzUuMmwxOS4zIDIyLjQgMjQuNS00MS0yNiAyOC4yeiIvPjwvZz48L3N2Zz4=",enableShiftClick:!0,graySelected:!0,scaleSelected:!0,fixedImageSize:!1,checkMark:"imgChked",checkMarkSize:"30px",checkMarkPosition:"top-left",scaleCheckMark:!0,fadeCheckMark:!1,addToForm:!1,inputValueAttribute:null,preselect:[],radio:!1,canDeselect:!1,styles:{},debugMessages:!1},n={"span.imgCheckbox":{"user-select":"none","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none",position:"relative",padding:"0",margin:"2px",display:"inline-block",border:"1px solid transparent","transition-duration":"300ms"},"span.imgCheckbox img":{display:"block",margin:"0",padding:"0","transition-duration":"300ms"},"span.imgCheckbox::before":{display:"block","background-size":"100% 100%",content:"''",color:"white","font-weight":"bold","border-radius":"50%",position:"absolute",margin:"0.5%","z-index":"1","text-align":"center","transition-duration":"300ms"}};function o(e,t,i){if("string"!=typeof e)return e;let s=document;return null===t&&i?s=i:t&&t instanceof Node&&"querySelector"in t?s=t:i&&i instanceof Node&&"querySelector"in i&&(s=i),"all"===t?s.querySelectorAll(e):s.querySelector(e)}let r="utils-style";const l={from:".utils",to:".utils-"};function c(e){return"object"==typeof e&&null!==e&&!a(e)}function a(e){return Array.isArray(e)}function h(e){return"number"!=typeof e&&("string"==typeof e&&0===e.length||(!(!a(e)||0!==e.length)||(!(!c(e)||0!==Object.keys(e).length)||!e)))}function d(e,...t){if(!t.length)return e;const i=t.shift();if(i)for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t)){const s=i[t],n=t;c(s)||a(s)?(e[n]&&"object"==typeof e[n]||(e[n]=a(s)?[]:{}),d(e[n],s)):e[n]=s}return d(e,...t)}function m(e){r=e}function g(e,t){l.from=e,l.to=t}function f(e,t=null){t=h(t)?"":t;let i=function(e,t={},i=""){let s=document.createElement(e);for(let e in t)Object.prototype.hasOwnProperty.call(t,e)&&("textContent"===e||"innerText"===e?s.textContent=t[e]:s.setAttribute(e,t[e]));return i&&(s.textContent=i),s}("style");i.id=r+t,i.textContent="",document.head.append(i);let s=i.sheet;for(let i in e)e.hasOwnProperty(i)&&p(s,i,u(e[i]),t)}function u(e){let t="";for(let[i,s]of Object.entries(e))i=i.replace(/([A-Z])/g,(e=>`-${e[0].toLowerCase()}`)),t+=`${i}:${s};`;return t}function p(e,t,i,s=null){s=h(s)?"":s;let n=t.replace(l.from,l.to+s);e.insertRule(n+"{"+i+"}",0)}function b(e=null){const t=h(e)?"":e;let i=o("#"+r+t);i&&i.parentNode&&i.parentNode.removeChild(i)}class k{static deepMerge=d;static setStylesheetId=m;static setReplaceRule=g;static injectStylesheet=f;static removeStylesheet=b;static getElem=o;static throwError=e=>{!function(e){throw new Error(e)}("[ImgCheckBox]: "+e)};static changeSelection(e,t,i,s,n,o,r){const{CHECK_MARK:l,CHK_DESELECT:c,CHK_TOGGLE:a,CHK_SELECT:h}=r;s&&t!==c?(o.forEach((t=>t!==e&&t.classList.remove(l))),n?e.classList.toggle(l):e.classList.add(l)):t===c&&e.classList.remove(l)||t===a&&e.classList.toggle(l)||t===h&&e.classList.add(l);const d=e.classList.contains(l);return i&&k.updateFormValues(s?o:e,l),d}static updateFormValues(e,t){(e instanceof Array?e:[e]).forEach((e=>{if(!("dataset"in e))return;const i=k.getElem("."+e.dataset.hiddenElementId,"all");i&&i.forEach((i=>{if(i instanceof HTMLElement&&"input"===i.tagName.toLowerCase()){const s=i;s.checked=e.classList.contains(t),s.checked?s.setAttribute("checked","checked"):s.removeAttribute("checked")}}))}))}static buildStyles(e,t,i,s){let n={};const o=(e,i,s=!1)=>{let o=e.startsWith("::")?"":" ";e||(o="."+t),n[`span.imgCheckbox${s?"."+t:""}${o}${e}`]=i};if("object"==typeof i&&"object"==typeof s)o(e,i),o(e,s,!0);else for(let[e,t]of Object.entries(i))o(e,t,!!e);return n}}k.setStylesheetId("imgCheckbox-style"),k.setReplaceRule(".imgCheckbox",".imgCheckbox");class y{callbacks={};init(e){e&&!this.callbacks[e]&&(this.callbacks[e]=[])}checkListener(e){if("function"!=typeof e)throw new TypeError("The listener must be a function")}hasEvent(e){return void 0!==this.callbacks[e]}listeners(){return this.callbacks}addListener(e,t){return this.on(e,t)}clearListener(e){return e?this.callbacks[e]=[]:this.callbacks={},this}on(e,t){return this.checkListener(t),this.init(e),this.callbacks[e].push(t),this}off(e,t){t&&this.checkListener(t);const i=e;return this.init(),this.callbacks[i]&&0!==this.callbacks[i].length?(this.callbacks[i]=t?this.callbacks[i].filter((e=>e!==t)):[],this):this}emit(e,...t){const i=e;if(this.init(i),this.callbacks[i].length<=0)return!1;const s=this.callbacks[i].map((e=>{try{const i=e(...t);return i instanceof Promise?i:Promise.resolve(i)}catch(e){return console.error(`Error in event listener for event: ${i}`,e),Promise.resolve()}}));return!s.some((e=>e instanceof Promise))||Promise.all(s).then((()=>!0)).catch((e=>(console.error(`Error handling promises for event: ${i}`,e),!1)))}once(e,t){this.checkListener(t);const i=(...s)=>{const n=t(...s);return this.off(e,i),n instanceof Promise?n:Promise.resolve(n)};return this.on(e,i)}}class C extends y{static instances=[];static version="3.1.1";element=[];options=s;targetIndex=0;imgChkMethods=new Map;constructor(e,t){return super(),this.initialize(e,t),C.instances.push(this),1===C.instances.length&&((e,t=!1)=>{!0===t?console.log("Data Type : "+typeof e,"\nValue : "+e):"boolean"!=typeof t?console.log(t):console.log(e)})(`ImgCheckBox is loaded, version: ${C.version}`),this}initialize(e,t){let i=k.getElem(e,"all");i||k.throwError("Element not found"),this.element=Array.isArray(i)?i:i instanceof NodeList?Array.from(i):[i],0===this.element.length&&k.throwError("Element not found"),this.options=k.deepMerge({},s,t||{}),this.createImgCheckbox(C.instances.length)}createImgCheckbox(e){const s=this.element,o=this.options;let r=null,l={},c=[],a=k.buildStyles("img",t,{transform:"scale(1)",filter:"none","-webkit-filter":"grayscale(0)"},{filter:"grayscale(1)","-webkit-filter":"grayscale(1)"}),h=k.buildStyles("img",t,{transform:"scale(1)"},{transform:"scale(0.9)"}),d=k.buildStyles("::before",t,{transform:"scale(0)"},{transform:"scale(1)"}),m=k.buildStyles("::before",t,{opacity:"0"},{opacity:"1"});o.checkMarkImage&&k.deepMerge(l,{"span.imgCheckbox::before":{"background-image":"url('"+o.checkMarkImage+"')"}});let g=o.checkMarkSize.split(" ");if(k.deepMerge(l,{"span.imgCheckbox::before":{width:g[0],height:g[g.length-1]}}),k.deepMerge(l,{"span.imgCheckbox::before":i[o.checkMarkPosition]}),o.fixedImageSize&&"string"==typeof o.fixedImageSize){let e=o.fixedImageSize.split(" ");k.deepMerge(l,{"span.imgCheckbox img":{width:e[0],height:e[e.length-1]}})}[{doExtension:o.graySelected,style:a},{doExtension:o.scaleSelected,style:h},{doExtension:o.scaleCheckMark,style:d},{doExtension:o.fadeCheckMark,style:m}].forEach((e=>{e.doExtension&&k.deepMerge(l,e.style)})),k.deepMerge(n,k.buildStyles("",t,{"":{"border-color":"#ccc"},img:{},"::before":{}})),l=k.deepMerge({},n,l,o.styles),k.injectStylesheet(l,e.toString());for(let t=0;t<s.length;t++){let i=s[t];if(i.parentNode?.classList.contains("imgCheckbox"+e))continue;if("img"!==i.tagName.toLowerCase())continue;i.ondragstart=()=>!1;let n=document.createElement("span");n.className="imgCheckbox"+e,i.parentNode?.insertBefore(n,i),n.appendChild(i),c.push(n);const r={deselect:()=>{k.changeSelection(n,2,o.addToForm,o.radio,o.canDeselect,c,C.constants),this.emit("deselect",n),this.emit("change",n,!1)},select:()=>{k.changeSelection(n,1,o.addToForm,o.radio,o.canDeselect,c,C.constants),this.emit("select",n),this.emit("change",n,!0)}};if(this.imgChkMethods.set(n,r),n.firstChild&&n.firstChild instanceof HTMLElement&&this.imgChkMethods.set(n.firstChild,r),o.addToForm instanceof Element||!0===o.addToForm){let s=null;s=!0===o.addToForm?i.closest("form"):o.addToForm;let n=o.inputValueAttribute&&i.getAttribute(o.inputValueAttribute)||"";if(s){let o="hEI"+e+"-"+t;const r=i.parentElement;r&&"dataset"in r&&(r.dataset.hiddenElementId=o);let l=i.getAttribute("name")||i.src.match(/\/([^\/]+)\.\w+$/)?.[1]||"",c=document.createElement("input");c.type="checkbox",c.name=l,c.className=o,c.style.display="none",c.value=n,s.appendChild(c)}else o.debugMessages&&console.warn("[ImgCheckBox]: No form found (looks for form by default)")}}return Array.isArray(this.options.preselect)?this.options.preselect.forEach((e=>{e>=0&&e<c.length&&this.imgChkMethods.get(c[e])?.select()})):!0===this.options.preselect&&c.forEach((e=>{this.imgChkMethods.get(e)?.select()})),c.forEach((e=>{e.addEventListener("click",(i=>{if(o.enableShiftClick&&!o.radio&&i.shiftKey&&r){let i=c.indexOf(r),s=c.indexOf(e);i>s&&([i,s]=[s,i]);for(let e=i;e<=s;e++){const i=c[e];i.classList.contains(t)||(this.imgChkMethods.get(i)?.select(),this.emit("click",i,!0))}}else{const t=k.changeSelection(e,0,o.addToForm,o.radio,o.canDeselect,c,C.constants);this.emit("click",e,t),t?this.emit("select",e):this.emit("deselect",e),this.emit("change",e,t)}r=e}))})),this}target(e){if(e>=0&&e<this.element.length)return this.targetIndex=e,this;k.throwError("The given index is out of range.")}state(){const e=k.getElem(this.element[this.targetIndex]).parentNode;return e&&e.classList.contains(t)}select(e){e<0||e>=this.element.length?k.throwError("The given index is out of range."):this.imgChkMethods.get(this.element[e])?.select()}deselect(e){e<0||e>=this.element.length?k.throwError("The given index is out of range."):this.imgChkMethods.get(this.element[e])?.deselect()}selectAll(){this.element.forEach((e=>{this.imgChkMethods.get(e)?.select()})),this.emit("selectAll",this.element)}deselectAll(){this.element.forEach((e=>{this.imgChkMethods.get(e)?.deselect()})),this.emit("deselectAll")}destroy(){let e=C.instances.indexOf(this);e<0?k.throwError("Instance not found"):(k.removeStylesheet(e.toString()),this.element.forEach((t=>{let i=t.parentNode;i&&i.classList.contains("imgCheckbox"+e)&&(i.parentNode?.insertBefore(t,i),i.parentNode?.removeChild(i))})),this.clearListener(),C.instances.splice(e,1))}getChecked(){return this.element.filter((e=>e.parentElement?.classList.contains(t)))}getUnchecked(){return this.element.filter((e=>!e.parentElement?.classList.contains(t)))}get length(){return this.element.length}static get constants(){return{CHECK_MARK:t,CHK_DESELECT:2,CHK_TOGGLE:0,CHK_SELECT:1}}}e.ImgCheckBox=C}));
