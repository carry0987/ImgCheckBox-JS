!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ImgCheckBox=t()}(this,(function(){"use strict";function e(e,t,i){if("string"!=typeof e)return e;let s=document;return null===t&&i?s=i:t&&t instanceof Node&&"querySelector"in t?s=t:i&&i instanceof Node&&"querySelector"in i&&(s=i),"all"===t?s.querySelectorAll(e):s.querySelector(e)}let t="utils-style";const i={from:".utils",to:".utils-"};function s(e){return Array.isArray(e)}function n(e){return"number"!=typeof e&&(!e||"string"==typeof e&&0===e.length)}function o(e,...t){if(!t.length)return e;const i=t.shift();if(i)for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t)){const r=i[t],l=t;"object"==typeof(n=r)&&null!==n&&!Array.isArray(n)||s(r)?(e[l]&&"object"==typeof e[l]||(e[l]=Array.isArray(r)?[]:{}),o(e[l],r)):e[l]=r}var n;return o(e,...t)}function r(e){t=e}function l(e,t){i.from=e,i.to=t}function c(e,i=null){i=n(i)?"":i;let s=function(e,t={},i=""){let s=document.createElement(e);for(let e in t)Object.prototype.hasOwnProperty.call(t,e)&&("textContent"===e||"innerText"===e?s.textContent=t[e]:s.setAttribute(e,t[e]));return i&&(s.textContent=i),s}("style");s.id=t+i,s.textContent="",document.head.append(s);let o=s.sheet;for(let t in e)e.hasOwnProperty(t)&&h(o,t,a(e[t]),i)}function a(e){let t="";for(let[i,s]of Object.entries(e))i=i.replace(/([A-Z])/g,(e=>`-${e[0].toLowerCase()}`)),t+=`${i}:${s};`;return t}function h(e,t,s,o=null){o=n(o)?"":o;let r=t.replace(i.from,i.to+o);e.insertRule(r+"{"+s+"}",0)}function d(i=null){const s=n(i)?"":i;let o=e("#"+t+s);o&&o.parentNode&&o.parentNode.removeChild(o)}class g{static deepMerge=o;static setStylesheetId=r;static setReplaceRule=l;static injectStylesheet=c;static removeStylesheet=d;static getElem=e;static throwError=e=>{!function(e){throw new Error(e)}("[ImgCheckBox]: "+e)};static changeSelection(e,t,i,s,n,o,r){const{CHECK_MARK:l,CHK_DESELECT:c,CHK_TOGGLE:a,CHK_SELECT:h}=r;s&&t!==c?(o.forEach((t=>t!==e&&t.classList.remove(l))),n?e.classList.toggle(l):e.classList.add(l)):t===c&&e.classList.remove(l)||t===a&&e.classList.toggle(l)||t===h&&e.classList.add(l);const d=e.classList.contains(l);return i&&g.updateFormValues(s?o:e,l),d}static updateFormValues(e,t){(e instanceof Array?e:[e]).forEach((e=>{if(!("dataset"in e))return;const i=g.getElem("."+e.dataset.hiddenElementId,"all");i&&i.forEach((i=>{if(i instanceof HTMLElement&&"input"===i.tagName.toLowerCase()){const s=i;s.checked=e.classList.contains(t),s.checked?s.setAttribute("checked","checked"):s.removeAttribute("checked")}}))}))}static buildStyles(e,t,i,s){let n={};const o=(e,i,s=!1)=>{let o=e.startsWith("::")?"":" ";e||(o="."+t),n[`span.imgCheckbox${s?"."+t:""}${o}${e}`]=i};if("object"==typeof i&&"object"==typeof s)o(e,i),o(e,s,!0);else for(let[e,t]of Object.entries(i))o(e,t,!!e);return n}}g.setStylesheetId("imgCheckbox-style"),g.setReplaceRule(".imgCheckbox",".imgCheckbox");const m="imgChked",f={"top-left":{top:"0.5%",left:"0.5%"},top:{top:"0.5%",left:0,right:0,margin:"auto"},"top-right":{top:"0.5%",right:"0.5%"},left:{left:"0.5%",bottom:0,top:0,margin:"auto"},right:{right:"0.5%",bottom:0,top:0,margin:"auto"},"bottom-left":{bottom:"0.5%",left:"0.5%"},bottom:{bottom:"0.5%",left:0,right:0,margin:"auto"},"bottom-right":{bottom:"0.5%",right:"0.5%"},center:{top:"0.5%",bottom:"0.5%",left:"0.5%",right:"0.5%",margin:"auto"}},u={checkMarkImage:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCAtMzQ2LjM4NCkiPjxwYXRoIGZpbGw9IiMxZWM4MWUiIGZpbGwtb3BhY2l0eT0iLjgiIGQ9Ik0zMiAzNDYuNGEzMiAzMiAwIDAgMC0zMiAzMiAzMiAzMiAwIDAgMCAzMiAzMiAzMiAzMiAwIDAgMCAzMi0zMiAzMiAzMiAwIDAgMC0zMi0zMnptMjEuMyAxMC4zbC0yNC41IDQxTDkuNSAzNzVsMTcuNyA5LjYgMjYtMjh6Ii8+PHBhdGggZmlsbD0iI2ZmZiIgZD0iTTkuNSAzNzUuMmwxOS4zIDIyLjQgMjQuNS00MS0yNiAyOC4yeiIvPjwvZz48L3N2Zz4=",enableShiftClick:!0,graySelected:!0,scaleSelected:!0,fixedImageSize:!1,checkMark:"imgChked",checkMarkSize:"30px",checkMarkPosition:"top-left",scaleCheckMark:!0,fadeCheckMark:!1,addToForm:!1,inputValueAttribute:null,preselect:[],radio:!1,canDeselect:!1,styles:{},debugMessages:!1},p={"span.imgCheckbox":{"user-select":"none","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none",position:"relative",padding:"0",margin:"2px",display:"inline-block",border:"1px solid transparent","transition-duration":"300ms"},"span.imgCheckbox img":{display:"block",margin:"0",padding:"0","transition-duration":"300ms"},"span.imgCheckbox::before":{display:"block","background-size":"100% 100%",content:"''",color:"white","font-weight":"bold","border-radius":"50%",position:"absolute",margin:"0.5%","z-index":"1","text-align":"center","transition-duration":"300ms"}};class b{callbacks={};init(e){e&&!this.callbacks[e]&&(this.callbacks[e]=[])}checkListener(e){if("function"!=typeof e)throw new TypeError("The listener must be a function")}hasEvent(e){return void 0!==this.callbacks[e]}listeners(){return this.callbacks}addListener(e,t){return this.on(e,t)}clearListener(e){return e?this.callbacks[e]=[]:this.callbacks={},this}on(e,t){return this.checkListener(t),this.init(e),this.callbacks[e].push(t),this}off(e,t){this.checkListener(t);const i=e;return this.init(),this.callbacks[i]&&0!==this.callbacks[i].length?(this.callbacks[i]=this.callbacks[i].filter((e=>e!=t)),this):this}async emit(e,...t){const i=e;return this.init(i),this.callbacks[i].length>0&&(await Promise.all(this.callbacks[i].map((async e=>await e(...t)))),!0)}once(e,t){this.checkListener(t);const i=async(...s)=>{await t(...s),this.off(e,i)};return this.on(e,i)}}class k extends b{static instances=[];static version="3.0.2";element=[];options=u;targetIndex=0;imgChkMethods=new Map;constructor(e,t){return super(),this.initialize(e,t),k.instances.push(this),1===k.instances.length&&((e,t=!1)=>{!0===t?console.log("Data Type : "+typeof e,"\nValue : "+e):"boolean"!=typeof t?console.log(t):console.log(e)})(`ImgCheckBox is loaded, version: ${k.version}`),this}initialize(e,t){let i=g.getElem(e,"all");i||g.throwError("Element not found"),this.element=Array.isArray(i)?i:i instanceof NodeList?Array.from(i):[i],0===this.element.length&&g.throwError("Element not found"),this.options=g.deepMerge({},u,t||{}),this.createImgCheckbox(k.instances.length)}createImgCheckbox(e){const t=this.element,i=this.options;let s=null,n={},o=[],r=g.buildStyles("img",m,{transform:"scale(1)",filter:"none","-webkit-filter":"grayscale(0)"},{filter:"grayscale(1)","-webkit-filter":"grayscale(1)"}),l=g.buildStyles("img",m,{transform:"scale(1)"},{transform:"scale(0.9)"}),c=g.buildStyles("::before",m,{transform:"scale(0)"},{transform:"scale(1)"}),a=g.buildStyles("::before",m,{opacity:"0"},{opacity:"1"});i.checkMarkImage&&g.deepMerge(n,{"span.imgCheckbox::before":{"background-image":"url('"+i.checkMarkImage+"')"}});let h=i.checkMarkSize.split(" ");if(g.deepMerge(n,{"span.imgCheckbox::before":{width:h[0],height:h[h.length-1]}}),g.deepMerge(n,{"span.imgCheckbox::before":f[i.checkMarkPosition]}),i.fixedImageSize&&"string"==typeof i.fixedImageSize){let e=i.fixedImageSize.split(" ");g.deepMerge(n,{"span.imgCheckbox img":{width:e[0],height:e[e.length-1]}})}[{doExtension:i.graySelected,style:r},{doExtension:i.scaleSelected,style:l},{doExtension:i.scaleCheckMark,style:c},{doExtension:i.fadeCheckMark,style:a}].forEach((e=>{e.doExtension&&g.deepMerge(n,e.style)})),g.deepMerge(p,g.buildStyles("",m,{"":{"border-color":"#ccc"},img:{},"::before":{}})),n=g.deepMerge({},p,n,i.styles),g.injectStylesheet(n,e.toString());for(let s=0;s<t.length;s++){let n=t[s];if(n.parentNode?.classList.contains("imgCheckbox"+e))continue;if("img"!==n.tagName.toLowerCase())continue;n.ondragstart=()=>!1;let r=document.createElement("span");r.className="imgCheckbox"+e,n.parentNode?.insertBefore(r,n),r.appendChild(n),o.push(r);const l={deselect:()=>{g.changeSelection(r,2,i.addToForm,i.radio,i.canDeselect,o,k.constants),this.emit("deselect",r),this.emit("change",r,!1)},select:()=>{g.changeSelection(r,1,i.addToForm,i.radio,i.canDeselect,o,k.constants),this.emit("select",r),this.emit("change",r,!0)}};if(this.imgChkMethods.set(r,l),r.firstChild&&r.firstChild instanceof HTMLElement&&this.imgChkMethods.set(r.firstChild,l),i.addToForm instanceof Element||!0===i.addToForm){let t=null;t=!0===i.addToForm?n.closest("form"):i.addToForm;let o=i.inputValueAttribute&&n.getAttribute(i.inputValueAttribute)||"";if(t){let i="hEI"+e+"-"+s;const r=n.parentElement;r&&"dataset"in r&&(r.dataset.hiddenElementId=i);let l=n.getAttribute("name")||n.src.match(/\/([^\/]+)\.\w+$/)?.[1]||"",c=document.createElement("input");c.type="checkbox",c.name=l,c.className=i,c.style.display="none",c.value=o,t.appendChild(c)}else i.debugMessages&&console.warn("[ImgCheckBox]: No form found (looks for form by default)")}}return Array.isArray(this.options.preselect)?this.options.preselect.forEach((e=>{e>=0&&e<o.length&&this.imgChkMethods.get(o[e])?.select()})):!0===this.options.preselect&&o.forEach((e=>{this.imgChkMethods.get(e)?.select()})),o.forEach((e=>{e.addEventListener("click",(t=>{if(i.enableShiftClick&&!i.radio&&t.shiftKey&&s){let t=o.indexOf(s),i=o.indexOf(e);t>i&&([t,i]=[i,t]);for(let e=t;e<=i;e++){const t=o[e];t.classList.contains(m)||(this.imgChkMethods.get(t)?.select(),this.emit("click",t,!0))}}else{const t=g.changeSelection(e,0,i.addToForm,i.radio,i.canDeselect,o,k.constants);this.emit("click",e,t),t?this.emit("select",e):this.emit("deselect",e),this.emit("change",e,t)}s=e}))})),this}target(e){if(e>=0&&e<this.element.length)return this.targetIndex=e,this;g.throwError("The given index is out of range.")}state(){const e=g.getElem(this.element[this.targetIndex]).parentNode;return e&&e.classList.contains(m)}select(e){e<0||e>=this.element.length?g.throwError("The given index is out of range."):this.imgChkMethods.get(this.element[e])?.select()}deselect(e){e<0||e>=this.element.length?g.throwError("The given index is out of range."):this.imgChkMethods.get(this.element[e])?.deselect()}selectAll(){this.element.forEach((e=>{this.imgChkMethods.get(e)?.select()})),this.emit("selectAll",this.element)}deselectAll(){this.element.forEach((e=>{this.imgChkMethods.get(e)?.deselect()})),this.emit("deselectAll")}destroy(){let e=k.instances.indexOf(this);e<0?g.throwError("Instance not found"):(g.removeStylesheet(e.toString()),this.element.forEach((t=>{let i=t.parentNode;i&&i.classList.contains("imgCheckbox"+e)&&(i.parentNode?.insertBefore(t,i),i.parentNode?.removeChild(i))})),this.clearListener(),k.instances.splice(e,1))}getChecked(){return this.element.filter((e=>e.parentElement?.classList.contains(m)))}getUnchecked(){return this.element.filter((e=>!e.parentElement?.classList.contains(m)))}get length(){return this.element.length}static get constants(){return{CHECK_MARK:m,CHK_DESELECT:2,CHK_TOGGLE:0,CHK_SELECT:1}}}return k}));
