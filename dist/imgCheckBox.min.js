!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ImgCheckBox=t()}(this,(function(){"use strict";function e(e){throw new Error(e)}function t(e,t,n){if("string"!=typeof e)return"all"===t?[e]:e;let i=document;return null===t&&n?i=n:t&&t instanceof Node&&"querySelector"in t?i=t:n&&n instanceof Node&&"querySelector"in n&&(i=n),"all"===t?i.querySelectorAll(e):i.querySelector(e)}let n="utils-style";const i={from:".utils",to:".utils-"};function o(e,...t){if(!t.length)return e;const n=t.shift();if(n)for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const s=n[t],l=t;"object"!=typeof(i=s)||null===i||Array.isArray(i)?e[l]=s:(e[l]&&"object"==typeof e[l]||(e[l]={}),o(e[l],s))}var i;return o(e,...t)}function s(e){n=e}function l(e,t){i.from=e,i.to=t}function a(e,t=null){t=d(t)?"":t;let i=function(e,t={},n=""){let i=document.createElement(e);for(let e in t)Object.prototype.hasOwnProperty.call(t,e)&&("textContent"===e||"innerText"===e?i.textContent=t[e]:i.setAttribute(e,t[e]));return n&&(i.textContent=n),i}("style");i.id=n+t,i.textContent="",document.head.append(i);let o=i.sheet;for(let n in e)e.hasOwnProperty(n)&&c(o,n,r(e[n]),t)}function r(e){let t="";for(let[n,i]of Object.entries(e))n=n.replace(/([A-Z])/g,(e=>`-${e[0].toLowerCase()}`)),t+=`${n}:${i};`;return t}function c(e,t,n,o=null){o=d(o)?"":o;let s=t.replace(i.from,i.to+o);e.insertRule(s+"{"+n+"}",0)}function h(e=null){const i=d(e)?"":e;let o=t("#"+n+i);o&&o.parentNode&&o.parentNode.removeChild(o)}function d(e){return"number"!=typeof e&&(!e||"string"==typeof e&&0===e.length)}class g{static throwError=e;static deepMerge=o;static setStylesheetId=s;static setReplaceRule=l;static injectStylesheet=a;static removeStylesheet=h;static getElem=t;static changeSelection(e,t,n,i,o,s,l){const{CHECK_MARK:a,CHK_DESELECT:r,CHK_TOGGLE:c,CHK_SELECT:h}=l,d=e.classList.contains(a);i&&t!==r?(s.forEach((t=>t!==e&&t.classList.remove(a))),o?e.classList.toggle(a):e.classList.add(a)):t===r&&e.classList.remove(a)||t===c&&e.classList.toggle(a)||t===h&&e.classList.add(a);const m=e.classList.contains(a);if(d!==m){const t=new CustomEvent("change",{detail:{isSelected:m}});e.dispatchEvent(t)}return n&&g.updateFormValues(i?s:e,a),m}static updateFormValues(e,t){(e instanceof Array?e:[e]).forEach((e=>{if(!("dataset"in e))return;const n=g.getElem("."+e.dataset.hiddenElementId,"all");n&&n.forEach((n=>{if(n instanceof HTMLElement&&"input"===n.tagName.toLowerCase()){const i=n;i.checked=e.classList.contains(t),i.checked?i.setAttribute("checked","checked"):i.removeAttribute("checked")}}))}))}static buildStyles(e,t,n,i){let o={};const s=(e,n,i=!1)=>{let s=e.startsWith("::")?"":" ";e||(s="."+t),o[`span.imgCheckbox${i?"."+t:""}${s}${e}`]=n};if("object"==typeof n&&"object"==typeof i)s(e,n),s(e,i,!0);else for(let[e,t]of Object.entries(n))s(e,t,!!e);return o}}g.setStylesheetId("imgCheckbox-style"),g.setReplaceRule(".imgCheckbox",".imgCheckbox");const m="imgChked",f={"top-left":{top:"0.5%",left:"0.5%"},top:{top:"0.5%",left:0,right:0,margin:"auto"},"top-right":{top:"0.5%",right:"0.5%"},left:{left:"0.5%",bottom:0,top:0,margin:"auto"},right:{right:"0.5%",bottom:0,top:0,margin:"auto"},"bottom-left":{bottom:"0.5%",left:"0.5%"},bottom:{bottom:"0.5%",left:0,right:0,margin:"auto"},"bottom-right":{bottom:"0.5%",right:"0.5%"},center:{top:"0.5%",bottom:"0.5%",left:"0.5%",right:"0.5%",margin:"auto"}},u={checkMarkImage:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCAtMzQ2LjM4NCkiPjxwYXRoIGZpbGw9IiMxZWM4MWUiIGZpbGwtb3BhY2l0eT0iLjgiIGQ9Ik0zMiAzNDYuNGEzMiAzMiAwIDAgMC0zMiAzMiAzMiAzMiAwIDAgMCAzMiAzMiAzMiAzMiAwIDAgMCAzMi0zMiAzMiAzMiAwIDAgMC0zMi0zMnptMjEuMyAxMC4zbC0yNC41IDQxTDkuNSAzNzVsMTcuNyA5LjYgMjYtMjh6Ii8+PHBhdGggZmlsbD0iI2ZmZiIgZD0iTTkuNSAzNzUuMmwxOS4zIDIyLjQgMjQuNS00MS0yNiAyOC4yeiIvPjwvZz48L3N2Zz4=",enableShiftClick:!0,graySelected:!0,scaleSelected:!0,fixedImageSize:!1,checkMark:"imgChked",checkMarkSize:"30px",checkMarkPosition:"top-left",scaleCheckMark:!0,fadeCheckMark:!1,addToForm:!1,inputValueAttribute:null,preselect:[],radio:!1,canDeselect:!1,styles:{},debugMessages:!1},C={"span.imgCheckbox":{"user-select":"none","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none",position:"relative",padding:"0",margin:"2px",display:"inline-block",border:"1px solid transparent","transition-duration":"300ms"},"span.imgCheckbox img":{display:"block",margin:"0",padding:"0","transition-duration":"300ms"},"span.imgCheckbox::before":{display:"block","background-size":"100% 100%",content:"''",color:"white","font-weight":"bold","border-radius":"50%",position:"absolute",margin:"0.5%","z-index":"1","text-align":"center","transition-duration":"300ms"}};class E{static instances=[];static version="2.2.1";element=[];options=u;targetIndex=0;imgChkMethods=new Map;static EVENT_CLICK="click";static EVENT_CHANGE="change";static EVENT_SELECT="select";static EVENT_DESELECT="deselect";onClickCallback=null;onChangeCallback=null;onSelectCallback=null;onDeselectCallback=null;constructor(e,t){this.init(e,t),E.instances.push(this),1===E.instances.length&&((e,t=!1)=>{!0===t?console.log("Data Type : "+typeof e,"\nValue : "+e):"boolean"!=typeof t?console.log(t):console.log(e)})(`ImgCheckBox is loaded, version: ${E.version}`)}init(e,t){let n=g.getElem(e,"all");n||g.throwError("Element not found"),this.element=Array.isArray(n)?n:n instanceof NodeList?Array.from(n):[n],0===this.element.length&&g.throwError("Element not found"),this.options=g.deepMerge({},u,t),this.onClickCallback=t.onClick||null,this.onChangeCallback=t.onChange||null,this.onSelectCallback=t.onSelect||null,this.onDeselectCallback=t.onDeselect||null,this.options?.onLoad?.(),this.createImgCheckbox(E.instances.length)}createImgCheckbox(e){const t=this.element,n=this.options;let i=null,o={},s=[],l=g.buildStyles("img",m,{transform:"scale(1)",filter:"none","-webkit-filter":"grayscale(0)"},{filter:"grayscale(1)","-webkit-filter":"grayscale(1)"}),a=g.buildStyles("img",m,{transform:"scale(1)"},{transform:"scale(0.9)"}),r=g.buildStyles("::before",m,{transform:"scale(0)"},{transform:"scale(1)"}),c=g.buildStyles("::before",m,{opacity:"0"},{opacity:"1"});n.checkMarkImage&&g.deepMerge(o,{"span.imgCheckbox::before":{"background-image":"url('"+n.checkMarkImage+"')"}});let h=n.checkMarkSize.split(" ");if(g.deepMerge(o,{"span.imgCheckbox::before":{width:h[0],height:h[h.length-1]}}),g.deepMerge(o,{"span.imgCheckbox::before":f[n.checkMarkPosition]}),n.fixedImageSize&&"string"==typeof n.fixedImageSize){let e=n.fixedImageSize.split(" ");g.deepMerge(o,{"span.imgCheckbox img":{width:e[0],height:e[e.length-1]}})}[{doExtension:n.graySelected,style:l},{doExtension:n.scaleSelected,style:a},{doExtension:n.scaleCheckMark,style:r},{doExtension:n.fadeCheckMark,style:c}].forEach((function(e){e.doExtension&&g.deepMerge(o,e.style)})),g.deepMerge(C,g.buildStyles("",m,{"":{"border-color":"#ccc"},img:{},"::before":{}})),o=g.deepMerge({},C,o,n.styles),g.injectStylesheet(o,e.toString());for(let i=0;i<t.length;i++){let o=t[i];if(o.parentNode?.classList.contains("imgCheckbox"+e))continue;if("img"!==o.tagName.toLowerCase())continue;o.ondragstart=()=>!1;let l=document.createElement("span");l.className="imgCheckbox"+e,o.parentNode?.insertBefore(l,o),l.appendChild(o),s.push(l);const a={deselect:()=>{g.changeSelection(l,2,n.addToForm,n.radio,n.canDeselect,s,E.constants),this.triggerEvent(E.EVENT_DESELECT,l)},select:()=>{g.changeSelection(l,1,n.addToForm,n.radio,n.canDeselect,s,E.constants),this.triggerEvent(E.EVENT_SELECT,l)}};if(this.imgChkMethods.set(l,a),l.firstChild&&l.firstChild instanceof HTMLElement&&this.imgChkMethods.set(l.firstChild,a),n.addToForm instanceof Element||!0===n.addToForm){let t=null;t=!0===n.addToForm?o.closest("form"):n.addToForm;let s=n.inputValueAttribute&&o.getAttribute(n.inputValueAttribute)||"";if(t){let n="hEI"+e+"-"+i;const l=o.parentElement;l&&"dataset"in l&&(l.dataset.hiddenElementId=n);let a=o.getAttribute("name")||o.src.match(/\/([^\/]+)\.\w+$/)?.[1]||"",r=document.createElement("input");r.type="checkbox",r.name=a,r.className=n,r.style.display="none",r.value=s,t.appendChild(r)}else n.debugMessages&&console.warn("ImgCheckBox: no form found (looks for form by default)")}}return Array.isArray(this.options.preselect)?this.options.preselect.forEach((e=>{if(e>=0&&e<s.length){const t=this.imgChkMethods.get(s[e])?.select;t?.()}})):!0===this.options.preselect&&s.forEach((e=>{const t=this.imgChkMethods.get(e)?.select;t?.()})),s.forEach((e=>{e.addEventListener("click",(t=>{if(n.enableShiftClick&&!n.radio&&t.shiftKey&&i){let t=s.indexOf(i),n=s.indexOf(e);t>n&&([t,n]=[n,t]);for(let e=t;e<=n;e++){const t=s[e];if(!t.classList.contains(m)){const e=this.imgChkMethods.get(t)?.select;e?.(),this.triggerEvent(E.EVENT_CLICK,t,!0),this.triggerEvent(E.EVENT_CHANGE,t,!0)}}}else{const t=g.changeSelection(e,0,n.addToForm,n.radio,n.canDeselect,s,E.constants);this.triggerEvent(E.EVENT_CLICK,e,t),t?this.triggerEvent(E.EVENT_SELECT,e):this.triggerEvent(E.EVENT_DESELECT,e)}i=e})),e.addEventListener("change",(t=>{const n=t;this.triggerEvent(E.EVENT_CHANGE,e,n.detail.isSelected)}))})),this}triggerEvent(e,t,n){switch(e){case E.EVENT_CLICK:void 0!==n&&this.onClickCallback?.(t,n);break;case E.EVENT_CHANGE:void 0!==n&&this.onChangeCallback?.(t,n);break;case E.EVENT_SELECT:this.onSelectCallback?.(t);break;case E.EVENT_DESELECT:this.onDeselectCallback?.(t);break;default:g.throwError(`Unsupported event type: ${e}`)}}target(e){if(e>=0&&e<this.element.length)return this.targetIndex=e,this;g.throwError("The given index is out of range.")}state(){const e=g.getElem(this.element[this.targetIndex]).parentNode;return e&&e.classList.contains(m)}select(e){e<0||e>=this.element.length?g.throwError("The given index is out of range."):this.element[e].imgChkSelect?.()}deselect(e){e<0||e>=this.element.length?g.throwError("The given index is out of range."):this.element[e].imgChkDeselect?.()}selectAll(){this.element.forEach((e=>e.imgChkSelect?.()))}deselectAll(){this.element.forEach((e=>e.imgChkDeselect?.()))}destroy(){let e=E.instances.indexOf(this);e<0?g.throwError("ImgCheckBox instance not found"):(g.removeStylesheet(e.toString()),this.element.forEach((t=>{let n=t.parentNode;n&&n.classList.contains("imgCheckbox"+e)&&(n.parentNode?.insertBefore(t,n),n.parentNode?.removeChild(n))})),E.instances.splice(e,1))}getChecked(){return this.element.filter((e=>e.parentElement?.classList.contains(m)))}getUnchecked(){return this.element.filter((e=>!e.parentElement?.classList.contains(m)))}set onClick(e){this.onClickCallback=e}set onChange(e){this.onChangeCallback=e}set onSelect(e){this.onSelectCallback=e}set onDeselect(e){this.onDeselectCallback=e}get length(){return this.element.length}static get constants(){return{CHECK_MARK:m,CHK_DESELECT:2,CHK_TOGGLE:0,CHK_SELECT:1}}}return E}));
